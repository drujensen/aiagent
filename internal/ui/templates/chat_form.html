{{define "chat_form_content"}}
<div class="chat-welcome">
    {{if not .IsEdit}}
    <h1>How may I help you today?</h1>
    <form hx-post="/chats" hx-target="#response-message" hx-swap="innerHTML" hx-trigger="submit, keydown[key == 'Enter' && !shiftKey] from:#first-message">
      <div class="form-group" style="margin-bottom: 20px;">
         <textarea name="message" id="first-message" class="form-control message-textarea" placeholder="Type your message here..." rows="6" required></textarea>
      </div>
      <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
         <div class="form-group" style="text-align: left;">
             <label for="agent-select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Agent:</label>
             <select id="agent-select" name="agent-select" class="form-control">
                 <option value="">Select an Agent</option>
                 {{range .Agents}}
                 <option value="{{.ID}}"{{if (eq .ID $.Chat.AgentID)}}selected{{end}}>{{.Name}}</option>
                 {{end}}
             </select>
             <small class="form-text" style="display: block; margin-top: 5px; font-size: 12px; color: #ccc;">Defines the AI's behavior and personality</small>
         </div>
         <div class="form-group" style="text-align: left;">
             <label for="model-select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Model:</label>
              <select id="model-select" name="model-select" class="form-control">
                  <option value="">Select a Model</option>
                  {{range .Models}}
                  <option value="{{.ID}}"{{if (eq .ID $.Chat.ModelID)}}selected{{end}}>{{.DisplayName}}</option>
                  {{end}}
              </select>
             <small class="form-text" style="display: block; margin-top: 5px; font-size: 12px; color: #ccc;">Controls speed, cost, and capabilities</small>
         </div>
      </div>
      <button type="submit" class="btn-primary">Send Message</button>
    </form>
    {{else}}
    <h1>Edit Chat</h1>
    <p>Configure your conversation settings below</p>
    <form hx-put="/chats/{{.Chat.ID}}" hx-target="#response-message" hx-swap="innerHTML">
      <h2 style="">Edit Chat</h2>
      <div class="form-group" style="margin-bottom: 20px; text-align: left;">
         <label for="chat-name" style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Conversation Name:</label>
         <input type="text" id="chat-name" name="chat-name" class="form-control" placeholder="Enter conversation name" value="{{.Chat.Name}}" required>
      </div>
      <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
         <div class="form-group" style="text-align: left;">
             <label for="agent-select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Agent:</label>
             <select id="agent-select" name="agent-select" class="form-control" required>
                 <option value="">Select an Agent</option>
                 {{range .Agents}}
                 <option value="{{.ID}}"{{if (eq .ID $.Chat.AgentID)}}selected{{end}}>{{.Name}}</option>
                 {{end}}
             </select>
         </div>
         <div class="form-group" style="text-align: left;">
             <label for="model-select" style="display: block; margin-bottom: 5px; font-weight: bold; color: #fff;">Model:</label>
              <select id="model-select" name="model-select" class="form-control" required>
                 <option value="">Select a Model</option>
                 {{range .Models}}
                 <option value="{{.ID}}"{{if (eq .ID $.Chat.ModelID)}}selected{{end}}>{{.DisplayName}}</option>
                 {{end}}
             </select>
         </div>
      </div>
       <button type="submit" class="btn-primary">Update Chat</button>
       <a href="/chats/{{.Chat.ID}}" class="btn-primary">Cancel</a>
     </form>
    {{end}}
    <div id="response-message"></div>
</div>

<style>
  .chat-welcome {
      background: #333;
      border: 1px solid #444;
      padding: 20px;
      border-radius: 8px;
      max-width: 800px;
      margin: 25px auto 0 auto;
      text-align: center;
  }

  .chat-welcome h1 {
      color: #fff;
      margin-bottom: 10px;
      font-size: 2.5em;
  }

   .chat-welcome h2 {
     color: #fff;
     margin-bottom: 20px;
     border-bottom: 2px solid #444;
   }

  .chat-welcome > p {
      color: #ccc;
      font-size: 1.2em;
      margin-bottom: 40px;
  }



   .form-row {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 20px;
       margin-bottom: 20px;
       padding-top: 20px;
   }

  .form-group {
      text-align: left;
  }

  .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #fff;
  }

  .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
      background-color: #1a1a1a;
      color: #fff;
  }

  .form-control:focus {
       outline: none;
       border-color: #007bff;
       box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
       background-color: #2a2a2a;
   }

   .message-textarea {
       resize: vertical;
       min-height: 120px;
       font-family: inherit;
       line-height: 1.4;
   }

  .form-text {
      display: block;
      margin-top: 5px;
      font-size: 12px;
      color: #ccc;
  }

  .form-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
  }

   .btn {
       border: none;
       border-radius: 6px;
       cursor: pointer;
       font-size: 14px;
       font-weight: 500;
       transition: all 0.2s;
       text-decoration: none;
       display: inline-block;
       text-align: center;
   }

   .btn-primary {
       padding: 10px 20px;
       background-color: #464EB8;
       color: #fff;
       border: none;
       border-radius: 0 0 5px 0;
       cursor: pointer;
       white-space: nowrap;
   }

   .btn-primary:hover {
       background-color: #3a42a0;
       transform: translateY(-1px);
   }

   .btn-secondary {
      background: #6c757d;
      color: white;
  }

  .btn-secondary:hover {
      background: #545b62;
      transform: translateY(-1px);
  }

   @media (max-width: 768px) {
       .form-row {
           grid-template-columns: 1fr;
           gap: 15px;
       }
   }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const textarea = document.getElementById('first-message');
  if (textarea) {
    textarea.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
      }
    });
  }
});
</script>
{{end}}
