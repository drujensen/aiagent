{{define "agent_form_content"}}
<div class="agent-form">
    <h2>{{if .Agent}}Edit Agent{{else}}Create Agent{{end}}</h2>
    <form {{if .Agent}}hx-put="/agents/{{.Agent.ID}}"{{else}}hx-post="/agents"{{end}} hx-target="#response-message">
        <input type="hidden" name="id" value="{{.Agent.ID}}">
        <div class="form-group">
            <label for="name">Agent Name:</label>
            <input type="text" id="name" name="name" class="form-control" value="{{.Agent.Name}}" required>
        </div>
        <div class="form-group">
            <label for="prompt">Prompt:</label>
            <textarea id="prompt" name="prompt" class="form-control" required>{{.Agent.Prompt}}</textarea>
        </div>
        <div class="form-group">
            <label for="tools">Tools:</label>
            <select id="tools" name="tools" class="form-control" multiple>
                {{range .Tools}}
                <option value="{{.ID}}" {{if .Selected}}selected{{end}}>{{.Name}}</option>
                {{end}}
            </select>
        </div>
        <fieldset class="form-group">
            <legend>AI Model Settings</legend>
            <div class="form-group">
                <label for="provider">Provider:</label>
                <select id="provider" name="provider" class="form-control">
                    {{range .Providers}}
                    <option value="{{.Value}}" {{if .Selected}}selected{{end}}>{{.Label}}</option>
                    {{end}}
                </select>
            </div>
            <div class="form-group">
                <label for="api_key">API Key:</label>
                <input type="text" id="api_key" name="api_key" class="form-control" value="{{.Agent.Configuration.APIKey}}">
                <small class="form-text text-muted">Use #{VAR_NAME}# to reference an environment variable.</small>
            </div>
            <div class="form-group">
                <label for="local_url">Local Model URL (optional):</label>
                <input type="text" id="local_url" name="local_url" class="form-control" value="{{.Agent.Configuration.LocalURL}}">
            </div>
            <div class="form-group">
                <label for="temperature">Temperature:</label>
                <input type="number" id="temperature" name="temperature" class="form-control" step="0.1" value="{{.Agent.Configuration.Temperature}}">
            </div>
            <div class="form-group">
                <label for="thinking_time">Thinking Time (ms):</label>
                <input type="number" id="thinking_time" name="thinking_time" class="form-control" value="{{.Agent.Configuration.ThinkingTime}}">
            </div>
        </fieldset>
        <div class="form-group">
            <label for="human_interaction">Enable Human Interaction:</label>
            <input type="checkbox" id="human_interaction" name="human_interaction" {{if .Agent.HumanInteractionEnabled}}checked{{end}}>
        </div>
        <button type="submit" class="btn btn-primary">Save Agent</button>
    </form>
    <div id="response-message"></div>
</div>
{{end}}
