{{define "agent_form"}}
<div class="agent-form">
  <!-- Dynamic heading based on whether editing or creating an agent -->
  <h2>{{if .Agent}}Edit Agent{{else}}Create Agent{{end}}</h2>
  
  <!-- Form with HTMX attributes for dynamic submission; action toggles based on agent ID -->
  <form {{if .Agent}}hx-put="/agents/{{.Agent.ID}}"{{else}}hx-post="/agents"{{end}} hx-target="#response-message">
    <!-- Hidden ID field for updates; empty for new agents -->
    <input type="hidden" name="id" value="{{.Agent.ID}}">

    <!-- Agent Name -->
    <div class="form-group">
      <label for="name">Agent Name:</label>
      <input type="text" id="name" name="name" class="form-control" value="{{.Agent.Name}}" required>
    </div>

    <!-- Custom Prompt -->
    <div class="form-group">
      <label for="prompt">Prompt:</label>
      <textarea id="prompt" name="prompt" class="form-control" required>{{.Agent.Prompt}}</textarea>
    </div>

    <!-- Tool Selection -->
    <div class="form-group">
      <label for="tools">Tools:</label>
      <select id="tools" name="tools" class="form-control" multiple>
        {{range .Tools}}
          <option value="{{.ID}}" {{if .Selected}}selected{{end}}>{{.Name}}</option>
        {{end}}
      </select>
    </div>

    <!-- AI Model Settings Group -->
    <fieldset class="form-group">
      <legend>AI Model Settings</legend>

      <!-- AI Provider Selection -->
      <div class="form-group">
        <label for="provider">Provider:</label>
        <select id="provider" name="provider" class="form-control">
          {{range .Providers}}
            <option value="{{.Value}}" {{if .Selected}}selected{{end}}>{{.Label}}</option>
          {{end}}
        </select>
      </div>

      <!-- API Key Input -->
      <div class="form-group">
        <label for="api_key">API Key:</label>
        <input type="text" id="api_key" name="api_key" class="form-control" value="{{.Agent.Configuration.APIKey}}">
        <small class="form-text text-muted">Use #{VAR_NAME}# to reference an environment variable.</small>
      </div>

      <!-- Local Model URL (Optional) -->
      <div class="form-group">
        <label for="local_url">Local Model URL (optional):</label>
        <input type="text" id="local_url" name="local_url" class="form-control" value="{{.Agent.Configuration.LocalURL}}">
      </div>

      <!-- Temperature Setting -->
      <div class="form-group">
        <label for="temperature">Temperature:</label>
        <input type="number" id="temperature" name="temperature" class="form-control" step="0.1" value="{{.Agent.Configuration.Temperature}}">
      </div>

      <!-- Thinking Time Setting -->
      <div class="form-group">
        <label for="thinking_time">Thinking Time (ms):</label>
        <input type="number" id="thinking_time" name="thinking_time" class="form-control" value="{{.Agent.Configuration.ThinkingTime}}">
      </div>
    </fieldset>

    <!-- Human Interaction Toggle -->
    <div class="form-group">
      <label for="human_interaction">Enable Human Interaction:</label>
      <input type="checkbox" id="human_interaction" name="human_interaction" {{if .Agent.HumanInteractionEnabled}}checked{{end}}>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary">Save Agent</button>
  </form>

  <!-- Response Area -->
  <div id="response-message"></div>
</div>
{{end}}
